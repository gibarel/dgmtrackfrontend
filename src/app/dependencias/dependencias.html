<div class="wrap">
  <h2>Dependencias</h2>

  <form [formGroup]="form" (ngSubmit)="crear()" class="card">
    <div class="row">
      <label>Nombre *</label>
      <input class="input" formControlName="nombre" />
    </div>
    <div class="row">
      <label>Descripción</label>
      <input class="input" formControlName="descripcion" />
    </div>
    <div class="row">
      <label>Padre</label>
      <select class="input" formControlName="padreId">
        <option [ngValue]="null">— Sin padre —</option>
        <option *ngFor="let d of lista" [ngValue]="d.id">{{ d.nombre }}</option>
      </select>
    </div>
    <button class="btn primary" type="submit" [disabled]="form.invalid">Crear</button>
  </form>

  <div *ngIf="cargando">Cargando...</div>
  <div *ngIf="error" class="error">{{ error }}</div>

  <ul class="lista">
    <li *ngFor="let d of lista">
      <div *ngIf="editId !== d.id; else editTpl" class="item">
        <div class="info">
          <strong>{{ d.nombre }}</strong>
          <span *ngIf="d.descripcion"> — {{ d.descripcion }}</span>
          <em *ngIf="d.padre"> · Sub de: {{ d.padre.nombre }}</em>
        </div>
        <div class="actions">
          <button class="btn" (click)="startEdit(d)">Editar</button>
          <button class="btn danger" (click)="eliminar(d.id)">Eliminar</button>
        </div>
      </div>

      <ng-template #editTpl>
        <form [formGroup]="editForm" (ngSubmit)="guardar()" class="inline-edit">
          <input class="input sm" formControlName="nombre" />
          <input class="input sm" formControlName="descripcion" />
          <select class="input sm" formControlName="padreId">
            <option [ngValue]="null">— Sin padre —</option>
            <option *ngFor="let p of lista" [ngValue]="p.id">{{ p.nombre }}</option>
          </select>
          <label><input type="checkbox" formControlName="activo" /> Activo</label>
          <button class="btn primary sm" type="submit" [disabled]="editForm.invalid">Guardar</button>
          <button class="btn sm" type="button" (click)="cancelar()">Cancelar</button>
        </form>
      </ng-template>
    </li>
  </ul>
</div>
